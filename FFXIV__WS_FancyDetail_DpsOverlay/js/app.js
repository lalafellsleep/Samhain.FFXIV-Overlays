var languagepack = 
{
	"Attack":"공격",
	"Shot":"공격",
	"Volley Fire":"집중 사격",
	"Mage's Balled":"현자의 담시곡",
	"Foe Requiem":"마인의 진혼곡",
	"Army's Paeon":"군신의 찬가",
	"Rain of Death":"죽음의 화살비",
	"Battle Voice":"전장의 서곡",
	"Vanderer's Minuet":"여행신의 무곡",
	"Empyreal Arrow":"천상의 화살",
	"Iron Jaws":"굳은 결의",
	"Warden's Paean":"시간신의 찬미가",
	"Sidewinder":"독사 강습",
	"Heavy Shot":"육중한 사격",
	"Straight Shot":"직선 사격",
	"Raging Strikes":"용맹한 사격",
	"Venomous Bite":"독화살",
	"Misery's End":"고통 종결",
	"Shadowbind":"그림자 묶기",
	"Bloodletter":"사혈 화살",
	"Repelling Shot":"후퇴 사격",
	"Quick Nock":"재빠른 활시위",
	"Swiftsong":"질주의 노래",
	"Hawk's Eye":"매의 눈",
	"Windbite":"바람 화살",
	"Quelling Strikes":"고요한 사격",
	"Barrage":"마구 쏘기",
	"Blunt Arrow":"침묵의 화살",
	"Flaming Arrow":"불타는 화살",
	"Wide Volley":"일제 사격",
	"Sword Oath":"충의의 검",
	"Cover":"감싸기",
	"Shield Oath":"충의의 방패",
	"Spirits Within":"내면의 기개",
	"Hallowed Ground":"천하무적",
	"Sheltron":"방벽",
	"Goring Blade":"꿰뚫는 검격",
	"Divine Veil":"신성한 보호막",
	"Clemency":"관용",
	"Royal Authority":"제왕의 권위",
	"Fast Blade":"재빠른 검격",
	"Rampart":"철벽 방어",
	"Savage Blade":"야성의 검격",
	"Fight of Flight":"임전무퇴",
	"Flash":"플래시",
	"Convalescence":"재활",
	"Riot Blade":"폭도의 검격",
	"Shield Lob":"방패 던지기",
	"Shield Bash":"방패 후려치기",
	"Provoke":"도발",
	"Rage Of Halone":"할로네의 분노",
	"Shield Swipe":"방패 가격",
	"Awareness":"경각심",
	"Sentinel":"경계",
	"Tempered Will":"강철의 의지",
	"Bulwark":"방패 각성",
	"Circle of Scorn":"파멸의 진",
	"Jump":"점프",
	"Elusive Jump":"교묘한 점프",
	"Spineshatter Dive":"척추 강타",
	"Power Surge":"용의 창",
	"Dragonfire Dive":"화룡강타",
	"Battle Lintany":"전투 기도",
	"Blood of the Dragon":"푸른 용혈",
	"Fang and Claw":"용의 발톱",
	"Wheeling Thrust":"용의 꼬리",
	"Geirskogul":"게이르스코굴",
	"True Thrust":"직선 찌르기",
	"Feint":"눈속임 공격",
	"Vorpal Thrust":"사선 찌르기",
	"Keen Flurry":"날카로운 돌풍",
	"Impulse Drive":"연쇄 충격",
	"Leg Sweep":"다리 쳐내기",
	"Heavy Thrust":"겹찌르기",
	"Piercing Talon":"창던지기",
	"Life Surge":"생명력 쇄도",
	"Invigorate":"기합",
	"Full Thrust":"올려 찌르기",
	"Phlebotomize":"연속 찌르기",
	"Blood for Blood":"필사의 각오",
	"Disembowel":"몸통 가르기",
	"Doom Spike":"악몽의 쐐기",
	"Ring of Thorns":"가시 소용돌이",
	"Chaos Thrust":"꽃잎 폭풍",
	"Inner Beast":"원초의 혼",
	"Steel Cyclone":"강철 소용돌이",
	"Fell Cleave":"참수",
	"Equilibrium":"평정심",
	"Decimate":"섬멸",
	"Heavy Swing":"육중한 일격",
	"Skull Sunder":"두개골 파쇄",
	"Fracture":"골절",
	"Brutal Swing":"잔혹한 일격",
	"Overpower":"압도",
	"Tomahawk":"도끼 던지기",
	"Maim":"관절 파괴",
	"Mercy Stroke":"최후의 일격",
	"Butcher's Block":"휘도는 도끼",
	"Thrill Of Battle":"전투의 짜릿함",
	"Storm's Path":"폭풍 쐐기",
	"Vengeance":"보복",
	"Strom's Eye":"폭풍의 눈",
	"Rockbreaker":"지열참",
	"Shoulder Tackle":"나찰충격권",
	"Fists of Fire":"홍련 태세",
	"One Ilm Punch":"촌경",
	"Dragon Kick":"쌍룡각",
	"From Shift":"연무",
	"Meditation":"투기",
	"The Forbidden Chakra":"음양투기참",
	"Purification":"기공술",
	"Elixir Field":"창기포",
	"Tornado Kick":"투혼선풍각",
	"Bootshine":"연격",
	"True Strike":"정권",
	"Snap Punch":"봉권",
	"Haymaker":"되받아치기",
	"Touch of Death":"혈도 찌르기",
	"Twin Snakes":"쌍장타",
	"Arm of the Destroyer":"충격파",
	"Demolish":"파쇄권",
	"Steel Peak":"철산고",
	"Howling Fist":"공명권",
	"Perfect Balance":"진각",
	"Second Wind":"내단",
	"Fuma Shuriken":"풍마 수리검",
	"Raiton":"뇌둔술",
	"Katon":"화둔술",
	"Suiton":"수둔술",
	"Doton":"토둔술",
	"Hyoton":"빙둔술",
	"Armor Crush":"갑각파황격",
	"Duality":"일쌍",
	"Dream Within a Dream":"몽환삼단",
	"Spinning Edge":"쌍검 회전베기",
	"Gust Slash":"돌풍 베기",
	"Mutilate":"무쌍베기",
	"Assassinate":"마지막 일격",
	"Throwing Dagger":"칼 던지기",
	"Mug":"약탈",
	"Sneak Attack":"기습 공격",
	"Aeolian Edge":"칼날 선풍",
	"Jugulate":"목 따기",
	"Dancing Edge":"춤추는 칼날",
	"Death Blossom":"피의 비",
	"Shadow Fang":"그림자 송곳니",
	"Trick Attack":"속임수 공격",
	"Split Shot":"분열탄",
	"Slug Shot":"슬러그탄",
	"Lead Shot":"산탄 사격",
	"Heartbreak":"심장 관통",
	"Leg Graze":"다리 쏘기",
	"Blank":"공포탄",
	"Spread Shot":"확산 사격",
	"Foot Graze":"발 쏘기",
	"Hot Shot":"강렬한 사격",
	"Head Graze":"머리 쏘기",
	"Clean Shot":"정밀탄",
	"Wildfire":"소이탄",
	"Suppressive Fire":"제압 사격",
	"Grenado Shot":"유탄 발사",
	"Gauss Round":"가우스탄",
	"Ricochet":"도탄 사격",
	"Hard Slash":"강렬한 참격",
	"Shadowskin":"그림자 비호",
	"Spinning Slash":"회전 참격",
	"Scourge":"재앙",
	"Unleash":"촉발",
	"Low Blow":"비열한 참격",
	"Syphon Strike":"흡수의 일격",
	"Unmend":"살의",
	"Reprisal":"앙갚음",
	"Power Slash":"대참격",
	"Souleater":"흡혼검",
	"Dark Passenger":"어둠의 여행자",
	"Delirium":"열광검",
	"Salted Earth":"감염 지대",
	"Plunge":"돌진",
	"Abyssal Drain":"심연의 갈증",
	"Sole Survivor":"최후의 생존자",
	"Carve And Spit":"난도질",
	"Freeze":"프리즈",
	"Fire":"파이어",
	"Fire II":"파이라",
	"Fire III":"파이가",
	"Fire IV":"파이쟈",
	"Flare":"플레어",
	"Blizzard":"블리자드",
	"Blizzard II":"블리자라",
	"Blizzard III":"블리자가",
	"Blizzard IV":"블리자쟈",
	"Thunder":"썬더",
	"Thunder II":"썬더라",
	"Thunder III":"썬더가",
	"Stone I":"스톤",
	"Stone II":"스톤라",
	"Stone III":"스톤가",
	"Holy":"홀리",
	"Benediction":"거룩한 축복",
	"Cure":"케알",
	"Cure II":"케알라",
	"Cure III":"케알가",
	"Medica":"메디카",
	"Medica II":"메디카라",
	"Asylum":"성소",
	"Aero":"에어로",
	"Aero II":"에어로라",
	"Aero III":"에어로가",
	"Assize":"심판",
	"Tetragrammaton":"신의 이름",
	"Ruin":"루인",
	"Ruin II":"루인라",
	"Ruin III":"루인가",
	"Bio":"바이오",
	"Bio II":"바이오라",
	"Energy Drain":"에테르 흡수",
	"Physick":"치유술",
	"Miasma":"미아즈마",
	"Miasma II":"미아즈라",
	"Fester":"미아즈마 버스트",
	"Sustain":"격려",
	"Eye for an Eye":"눈에는 눈",
	"Shadow Flare":"섀도우 플레어",
	"Enkindle":"점화",
	"Painflare":"고통의 불길",
	"Tri-disaster":"트라이디재스터",
	"Deathflare":"데스 플레어",
	"Adloquium":"고무격려책",
	"Succor":"사기고양책",
	"Lustrate":"생명활성술",
	"Indomitability":"불굴불요책",
	"Broil":"기염법",
	"Emergency Tactics":"응급 전술",
	"Dissipation":"에테르 전환",
	"Essential Dignity":"본질적 위계",
	"Benefic":"베네피크",
	"Benefic II":"베네피라",
	"Malefic":"말레피크",
	"Malefic II":"말레피라",
	"Helios":"헬리오스",
	"Stella":"스텔라",
	"Aspected Benefic":"별읽기: 베네피크",
	"Aspected Helios":"별읽기: 헬리오스",
	"Gravity":"그라비데",
	"Collective Unconscious":"운명의 수레바퀴",
	"Celestial Opposition":"천궁의 반목",
	"Combust":"컴버스",
	"Combust II":"컴버라",

	"Braver":"브레이버",
	"Bladedance":"쾌검난무",
	"Final Heaven":"파이널 헤븐[몽크]",
	"Dragonsong Dive":"창룡 강타[용기]",
	"Chimatsuri":"피의 축제[닌자]",

	"Big Shot":"분노의 사격",
	"Desperado":"무법자",
	"Satellite Beam":"위성 저격[기공]",
	"Saggitarius Arrow":"궁수자리 화살[음유]",

	"Skyshard":"하늘의 조각",
	"Starstorm":"프티 메테오",
	"Meteor":"메테오[흑마]",
	"Teraflare":"테라플레어[소환]",

	"Healing Wind":"치유의 바람",
	"Breath of the Earth":"대지의 숨결",
	"Pulse of Life":"생명의 고동[백마]",
	"Angel Feathers":"천사의 깃털[학자]",
	"Astral Stasis":"천궁의 문[점성]",
};

var combatants = [];
var lastEncounterRecord = [];
var sorttype = "asc";

$(document).ready(function() 
{
	init();
	window.addEventListener('message', onMessage);
});

function saveSetting()
{
	var setting = {
		nicknamehide:$("#nicknamehide").attr("data-checked"),
		mergeAvatar:$("#mergeAvatar").attr("data-checked")
	};

	localStorage.setItem("fancy_setting", JSON.stringify(setting));
}

function loadSetting()
{
	return JSON.parse(localStorage.getItem("fancy_setting"));
}

function encounterAct()
{
	if(lastCombat == null) return;
	var c = lastCombat;
	c.summonerMerge = isAvatarMerge();

	var s = sortKey;

	if(s == "encdps" && isAvatarMerge())
		s = "mergedDamage";
	else if(s == "enchps" && isAvatarMerge())
		s = "mergedHealed";
	else if(s == "encdps" && !isAvatarMerge())
		s = "damage";
	else if(s == "enchps" && !isAvatarMerge())
		s = "healed";

	$(".duration").html(c.Encounter.duration);
	$(".title").html(c.Encounter.title);

	$(".rdps").html(c.Encounter.encdps+" RD");
	$(".rhps").html(c.Encounter.enchps+" RH");
	$(".rdamage").html(c.Encounter.damage+" TD");
	$(".rhealed").html(c.Encounter.healed+" TH");


	if (sorttype == "desc")
		c.sortkeyChangeDesc(s);
	else
		c.sortkeyChange(s);
	
	for(var i in c.persons)
	{
		if(isAvatarMerge() && c.persons[i].isPet) continue;
		addItem(c.persons[i]);
	}

	$(".content .item").each(function(){
		var n = $(this).attr("data-id");
		var rm = true;
		for(var i in c.persons)
		{
			if(isAvatarMerge() && c.persons[i].isPet) continue;
			if(c.persons[i].name == n) rm = false;
		}
		if(rm) $(this).remove();
	});

	if(getCombatant(c) == false && c.Encounter.title != "Encounter")
	{
		setCombatant(c);
		$(".battlelog").prepend("<div data-id=\""+c.combatKey+"\" onclick=\"loadCombat($(this).attr('data-id'));\">"+c.Encounter.title+"</div>");
	}

	resize();
}

function loadCombat(combatid)
{
	for(var i in combatants)
	{
		if(combatants[i].combatKey == combatid) 
		{
			lastCombat = combatants[i];
			break;
		}
	}
	encounterAct();
	showBattleLog();
}

function getCombatant(c)
{
	for(var i in combatants)
	{
		if(combatants[i].combatKey == c.combatKey) return true;
	}
	return false;
}

function setCombatant(c)
{
	for(var i in combatants)
	{
		if(combatants[i].combatKey == c.combatKey) return false;
	}

	combatants.push(c);
	return true;
}

function isAvatarMerge()
{
	return $("#mergeAvatar").attr("data-checked")=="true";
}

function onMessage(e) 
{
	if (e.data.type === 'onOverlayDataUpdate') 
		onOverlayDataUpdate(e.data);
}

function addItem(e)
{
	if(!getItem(e.name))
		$(".content").append("<div class=\"item\" data-job=\""+e.Class+"\" data-id=\""+e.name+"\" style=\"top:"+((e.rank+2)*27)+"px; opacity:0;\"><div class=\"icon\"></div><div class=\"leftdeco d\"></div><div class=\"leftdeco\"></div><div class=\"datas\"><div class=\"values\"><div class=\"vv\"></div></div><div class=\"bar\"></div></div></div>");
	
	modifyItem(e);
}

function getItem(id)
{
	if($(".content .item[data-id=\""+id+"\"]").length > 0)
		return $(".content .item[data-id=\""+id+"\"]");
	else
		return false;
}

function modifyItem(e)
{
	var item = getItem(e.name);
	
	if(e.avatar)
		$(item).find(".icon").css({"background-image":"url(./icon/AVA.png)", "background-size":"20px auto", "background-position":"0px 3px"});

	$(item).attr("data-job", e.Class.toUpperCase());
	$(item).find(".datas>.values>.vv>span").remove();

	if($(item).find(".datas>.values>i").length == 0)
		$(item).find(".datas>.values").append("<i style=\"width:120px; overflow:hidden; word-break:none;\">"+e.name+"</i>");

	if($("#nicknamehide").attr("data-checked")=="true" && e.name != "YOU" && e.name != "Limit Break")
		$(item).find(".datas>.values>i").css("-webkit-filter","blur(3px)");
	else
		$(item).find(".datas>.values>i").css("-webkit-filter","");

	for(var i in sortObject[selectTab])
	{
		var text = i;
		if(sortObject[selectTab][i].display)
		{
			var targ = e[i];
			if(i == "maxhit")
				targ = e.maxhitstr+" - "+e.maxhitval;
			if(i == "maxheal")
				targ = e.maxhealstr+" - "+e.maxhealval;
			
			$(item).find(".datas>.values>.vv").append(
				"<span style=\"float:left; overflow:hidden; margin-left:3px; text-align:center; font-family:'돋움체';"+
				(sortObject[selectTab][i].width===undefined?" width:38px;":" width:"+sortObject[selectTab][i].width+"px;")+"\">"+targ+"</div>");
		}
	}

	$(item).css({"top":(e.rank*24), "z-index":(25-e.rank), "opacity":1});
	$(item).find(".bar").width(parseFloat(e[e.parent.sortkey] / e.maxdamage * 100).toFixed(2)+"%");
}

function showBattleLog()
{
	if($(".battlelog").css("display") == "none")
	{
		$(".content").hide();
		$(".battlelog").show();
	}
	else
	{
		$(".content").show();
		$(".battlelog").hide();
	}
}

function windowmode() 
{
	var el = document
	, rfs = // for newer Webkit and Firefox
	el.exitFullScreen
	|| el.webkitExitFullscreen
	|| el.mozCancelFullScreen
	|| el.msExitFullScreen
	rfs.call(el);
}

function fullscreen() 
{
	var el = document.documentElement
	, rfs = // for newer Webkit and Firefox
	el.requestFullScreen
	|| el.webkitRequestFullScreen
	|| el.mozRequestFullScreen
	|| el.msRequestFullscreen
	;
	rfs.call(el);
}

function isFullscreen()
{
	return (document.fullscreen || document.webkitIsFullScreen || document.mozFullScreen || document.msFullscreenElement);
}

function resort(obj)
{
	var tabs = "";
	var temp = "";
	var first = false;
	var sort = "";

	selectTab = $(obj).html();

	for(var i in sortObject)
	{
		tabs += "<div class=\"tab";
		if(i == selectTab)
		tabs += " seltab";
		tabs += "\" onclick=\"resort(this);\">"+i+"</div>";
	}

	for(var i in sortObject[selectTab])
	{
		if(!first)
		{
			sort = i;
			first = true;
		}

		if(sortObject[selectTab][i].display)
			temp += "<div data-sort=\"none\" data=\""+i+"\" "+(sortObject[selectTab][i].width===undefined?"":"style=\"width:"+sortObject[selectTab][i].width+"px;\"")+">"+sortObject[selectTab][i].label+"</div>";
	}

	$(".tabs").html(tabs);
	$(".datasort").html(temp);

	defaultSort = sortKey = sort;

	$(".datasort div[data=\""+defaultSort+"\"]").attr("data-sort","asc");
	encounterAct();
	
	$(".datasort div").click(function(){
		sorttype="asc";
		if($(this).attr("data-sort") == "asc")
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","desc");
			sorttype="desc";
		}
		else if($(this).attr("data-sort") == "desc")
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","asc");
		}
		else
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","asc");
		}
		sortKey = $(this).attr("data");
		encounterAct();
	});
}

function init()
{
	var version = "2016.12.21";
	var temp = "";
	var tabs = "";
	console.log("Isloaded");
	for(var i in sortObject)
	{
		tabs += "<div class=\"tab";
		if(i == selectTab)
		tabs += " seltab";
		tabs += "\" onclick=\"resort(this);\">"+i+"</div>";
	}
	for(var i in sortObject[selectTab])
	{
		if(sortObject[selectTab][i].display)
			temp += "<div data-sort=\"none\" data=\""+i+"\" "+(sortObject[selectTab][i].width===undefined?"":"style=\"width:"+sortObject[selectTab][i].width+"px;\"")+">"+sortObject[selectTab][i].label+"</div>";
	}

	var html = "<div class=\"tooltip\"></div><div class=\"messagearea\"></div>"+
	"<header>"+
	"<div class=\"tabs\">"+
	tabs+
	"</div>"+
	"<div class=\"icon\" onmouseover=\"$('.tooltip').show(); $('.tooltip').css({'left':'0px', 'right':'auto', 'top':'45px'}); $('.tooltip').html('<div>전투 기록</div><div>최근 20개의 전투 기록을 불러와 볼 수 있습니다.</div>');\" onmouseleave=\"$('.tooltip').hide();\" style=\"background:url(img/calendar-text.png) no-repeat center center; background-size:90% auto; float:left;\" onclick=\"if($('.title').html().toString().indexOf('집계 중') == -1){showBattleLog();}\"></div>"+
	"<div class=\"duration\">00:00</div>"+
	"<div class=\"title\">---</div>"+
	"<div class=\"datacov\"><div class=\"rdps\">0 AvgDPS</div>"+
	"<div class=\"rhps\">0 AvgHPS</div>"+
	"<div class=\"rdamage\">0 Tot.Dmg</div>"+
	"<div class=\"rhealed\">0 Tot.Heal</div></div>"+
	"<div class=\"icons\">"+
	"<div class=\"icon\" onmouseover=\"$('.tooltip').show(); $('.tooltip').css({'left':'auto', 'right':'0px', 'top':'25px'}); $('.tooltip').html('<div>인카운터 종료</div><div>진행중인 인카운터를 끝내고 새 인카운터를 시작합니다.</div>');\" onmouseleave=\"$('.tooltip').hide();\" style=\"background:url(img/update.png) no-repeat center center; background-size:100% auto;\" onclick=\"endEncounter();\"></div>"+
	"<div class=\"icon\" onmouseover=\"$('.tooltip').show(); $('.tooltip').css({'left':'auto', 'right':'0px', 'top':'25px'}); $('.tooltip').html('<div>스크린샷</div><div>현재 미터기 화면을 저장합니다.</div>');\" onmouseleave=\"$('.tooltip').hide();\" style=\"background:url(img/camera.png) no-repeat center center; background-size:80% auto;\" onclick=\"execScr();\"></div>"+
	"<div class=\"icon\" onmouseover=\"$('.tooltip').show(); $('.tooltip').css({'right':'0px', 'left':'auto', 'top':'25px'}); $('.tooltip').html('<div>소환수 합산</div><div>소환수와 플레이어의 값을 합산합니다.</div>');\" onmouseleave=\"$('.tooltip').hide();\" style=\"background:url(img/account-multiple-plus.png) no-repeat center center; background-size:90% auto;\" data-checked=\"true\" id=\"mergeAvatar\"></div>"+
	"<div class=\"icon\" onmouseover=\"$('.tooltip').show(); $('.tooltip').css({'right':'0px', 'left':'auto', 'top':'25px'}); $('.tooltip').html('<div>이름 모자이크</div><div>유저의 이름을 블러 처리 합니다.</div>');\" onmouseleave=\"$('.tooltip').hide();\" style=\"background:url(img/dns.png) no-repeat center center; background-size:90% auto;\" data-checked=\"true\" id=\"nicknamehide\"></div>"+
	"</div>";
	
	if(isFullscreen())
	{
		
	}
	else
	{

	}
	html +=
	"</header>"+
	"<div class=\"datasort\">"+
	temp+
	"</div>"+
	"<div class=\"content\">"+
	"<div class=\"item\" data-job=\"WAR\">"+
	"<div class=\"icon\"></div>"+
	"<div class=\"leftdeco\"></div>"+
	"<div class=\"datas\">"+
	"</div>"+
	"</div>"+
	"</div>"+
	"<div class=\"battlelog\" style=\"display:none;\">"+
	"</div>";

	$("body").append(html);

	setTimeout(function(){
		var setting = loadSetting();
		for(var i in setting)
		{
			$("#"+i).attr("data-checked", setting[i]);
		}
		encounterAct();
	},1000);

	if (document.addEventListener) 
	{
		window.onbeforeunload = function() 
		{
			document.removeEventListener('onOverlayDataUpdate', onOverlayDataUpdate);
			window.removeEventListener('message', onMessage);
		};

		window.addEventListener("unload", function() 
		{
			document.removeEventListener('onOverlayDataUpdate', onOverlayDataUpdate);
			window.removeEventListener('message', onMessage);
		}, false);
	}

	$(".datasort div[data=\""+defaultSort+"\"]").attr("data-sort","asc");

	$(".content *").remove();

	$("header .icon[data-checked]").click(function(){
		if($(this).attr("data-checked")=="true")
			$(this).attr("data-checked", "false");
		else
			$(this).attr("data-checked", "true");
		
		encounterAct();
		saveSetting();
	});

	$(".datasort div").click(function(){
		sorttype="asc";
		if($(this).attr("data-sort") == "asc")
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","desc");
			sorttype="desc";
		}
		else if($(this).attr("data-sort") == "desc")
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","asc");
		}
		else
		{
			$(".datasort div").attr("data-sort","none");
			$(this).attr("data-sort","asc");
		}
		sortKey = $(this).attr("data");
		encounterAct();
	});
}

function execScr()
{
	$(".tooltip").hide();
	setTimeout(function(){takeScreenshot();}, 200);
	setTimeout(function(){$(".tooltip").show();}, 1000);
	
}

function removeItem(id)
{
	$(".content .item[data-id=\""+id+"\"]").remove();
}

function onOverlayDataUpdate(e)
{
	lastCombat = new Combatant(e);
	encounterAct(e);
	$(".loading").fadeOut();
}

function onOverlayStateUpdate(e)
{

}

function onLogLineRead(e)
{

}

function beforeLogLineRead(e)
{

}

// called takeScreenshot()
function onScreenShotTaked(e)
{
	if(e.detail.take == true)
	{
		fadeOutLbl("스크린샷을 촬영했습니다.");
	}
	else
	{
		fadeOutLbl("현재 플러그인이 스크린샷 기능을 지원하지 않습니다.");
	}
}

function onEncounterEndExecuted(e)
{
	if(e.detail.take == true)
	{
		if(lastCombat == null || lastCombat.encounter.title != "Encounter")
			fadeOutLbl("진행된 전투가 없습니다.");
		else
			fadeOutLbl("인카운터가 종료되었습니다.");
	}
	else
	{
		fadeOutLbl("현재 플러그인이 인카운터 종료 기능을 지원하지 않습니다.");
	}
}

function onZoomSizeChanged(e)
{
	if(e.detail.take == true)
	{
		delayOK = true;
	}
	else
	{
		fadeOutLbl("현재 플러그인이 줌 크기 변경을 지원하지 않습니다.");
	}
}

var delayOK = true;
function fadeOutLbl(string)
{
	if(!delayOK) return;
	delayOK = false;
	$("div.messagearea span").remove();
	$("div.messagearea").append("<span style='opacity:0;'>"+string+"</span>");
	$("div.messagearea span").css("opacity", "1");
	setTimeout(function(){$("div.messagearea span").css("opacity", "0");}, 1000);
	setTimeout(function(){$("div.messagearea span").remove(); delayOK = true;}, 1500);
}

$(window).resize(function(){resize()});

function resize()
{
	var vwidth = $(".item>.datas>.values").width() - $(".item>.datas>.values>.vv").width() ;
	$(".item>.datas>.values>i").css({"display":"inline-block", "width":vwidth, "overflow":"hidden"});
}